import numpy as np
import ssd_detect
import extract_embeddings
import cv2
import face_recognition
import time

ssd = ssd_detect.SSDFaceDetectorOpenCV()
get_emb = extract_embeddings.FaceEmbeddingExtractor()

list_embeddings_known = [
    [-0.04896817356348038, 0.12061870098114014, -0.03574241325259209, -0.05840500816702843, -0.03588976338505745,
     -0.000630395021289587, -0.07891542464494705, -0.152434304356575, 0.14130112528800964, -0.07520470768213272,
     0.21953439712524414, 0.007819773629307747, -0.20769795775413513, -0.1674770563840866, -0.06207834184169769,
     0.19302085041999817, -0.1558723896741867, -0.16730935871601105, -0.03968852013349533, 0.005742937326431274,
     0.08756806701421738, 0.03740209713578224, 0.035277847200632095, 0.04712017998099327, -0.1504479944705963,
     -0.28197288513183594, -0.0926593467593193, -0.09194287657737732, -0.024423817172646523, -0.07165499031543732,
     -0.05478547513484955, 0.01850196346640587, -0.20267978310585022, -0.027816157788038254, 0.08064830303192139,
     0.08312530815601349, -0.03258558362722397, -0.023583073168992996, 0.18408912420272827, 0.039974648505449295,
     -0.21881963312625885, 0.06533187627792358, 0.041714660823345184, 0.25524622201919556, 0.21519987285137177,
     0.04015837609767914, 0.01597665436565876, -0.19004297256469727, 0.10235309600830078, -0.12792152166366577,
     0.0806318148970604, 0.18128763139247894, 0.07371354848146439, 0.06681837141513824, 0.00904767494648695,
     -0.15203672647476196, 0.011814525350928307, 0.12150941044092178, -0.14089378714561462, -0.017347067594528198,
     0.07633712142705917, 0.001372992992401123, -0.05076061561703682, -0.10033933073282242, 0.1956024020910263,
     0.0331704281270504, -0.15481768548488617, -0.19191093742847443, 0.13478438556194305, -0.13845977187156677,
     -0.07832879573106766, 0.09051945060491562, -0.1830122470855713, -0.23352906107902527, -0.29094642400741577,
     0.0336831733584404, 0.35857856273651123, 0.18117928504943848, -0.20057237148284912, 0.06340938806533813,
     -0.025394108146429062, 0.015328522771596909, 0.11078333109617233, 0.13572846353054047, -0.004979509860277176,
     0.05880803242325783, -0.044230975210666656, 0.024864614009857178, 0.19602523744106293, -0.030424106866121292,
     -0.054602593183517456, 0.23479828238487244, -0.024197068065404892, 0.09507396817207336, 0.005510480608791113,
     -0.007139337249100208, -0.026960939168930054, 0.05503341183066368, -0.1471184939146042, -0.02948775887489319,
     -0.0066196005791425705, 0.009807704016566277, 0.02724366821348667, 0.1463669389486313, -0.09947963058948517,
     0.13812938332557678, 0.02088913507759571, 0.05546595901250839, -0.019154183566570282, 0.027127984911203384,
     -0.11142943054437637, -0.06200753152370453, 0.12001581490039825, -0.23346981406211853, 0.2504784166812897,
     0.1593335121870041, 0.10053732991218567, 0.06282855570316315, 0.15280860662460327, 0.09024904668331146,
     -0.001469029113650322, -0.03411945700645447, -0.2527535557746887, 0.002653753152117133, 0.11549019813537598,
     -0.06046583503484726, 0.14485163986682892, -0.011162225157022476],
    [-0.0497431643307209, 0.04665033519268036, -0.008050143718719482, -0.06839440762996674, -0.08172158151865005,
     -0.0009991209954023361, -0.09323500841856003, -0.09141059219837189, 0.11540975421667099, -0.09626246988773346,
     0.22934551537036896, -0.03244667872786522, -0.1764812022447586, -0.11371912062168121, -0.03253396973013878,
     0.1858660876750946, -0.13825325667858124, -0.14944283664226532, -0.040427688509225845, 0.014385112561285496,
     0.054608386009931564, 0.04303150251507759, 0.04195013642311096, 0.05852769687771797, -0.18149051070213318,
     -0.33935317397117615, -0.10408192127943039, -0.10784394294023514, -0.043541476130485535, -0.04049902781844139,
     -0.0720553919672966, 0.0014344824012368917, -0.21985238790512085, -0.049213580787181854, 0.053142376244068146,
     0.032818444073200226, -0.02765648625791073, -0.039678581058979034, 0.20385369658470154, 0.04997061565518379,
     -0.23528994619846344, 0.06103573366999626, 0.03752290457487106, 0.24085906147956848, 0.16854670643806458,
     0.04695773869752884, 0.027629178017377853, -0.16080346703529358, 0.09406395256519318, -0.12854218482971191,
     0.1107056736946106, 0.13226301968097687, 0.05438512936234474, 0.059548333287239075, -0.025971904397010803,
     -0.09499981254339218, 0.035281769931316376, 0.17540757358074188, -0.15319661796092987, 0.023454638198018074,
     0.04879993572831154, 0.003957977518439293, -0.015719017013907433, -0.08227022737264633, 0.2089066356420517,
     0.0427255854010582, -0.11011815816164017, -0.18655994534492493, 0.1074097529053688, -0.1206849217414856,
     -0.0877029299736023, 0.06773734092712402, -0.17333321273326874, -0.2349502146244049, -0.3372994661331177,
     0.038976676762104034, 0.35845205187797546, 0.15429934859275818, -0.21949206292629242, 0.04181983694434166,
     -0.0165200624614954, -0.017708636820316315, 0.15014898777008057, 0.1314489245414734, 0.006185917183756828,
     0.0305641982704401, -0.04623102396726608, 0.03313741087913513, 0.24213021993637085, -0.036052100360393524,
     -0.046924296766519547, 0.2468453198671341, -0.0005667936056852341, 0.09005516767501831, 0.03115755133330822,
     0.03401021659374237, -0.04388032108545303, 0.054631415754556656, -0.13496613502502441, 0.0076482854783535,
     0.02403584122657776, 0.03387437015771866, 0.009703971445560455, 0.1477750986814499, -0.14449277520179749,
     0.143572598695755, 0.011007219552993774, 0.008677521720528603, 0.0033244253136217594, 0.04268111288547516,
     -0.10635343194007874, -0.11217803508043289, 0.11295568943023682, -0.1980656385421753, 0.18386231362819672,
     0.17120978236198425, 0.12050420045852661, 0.0989377498626709, 0.14154879748821259, 0.050073474645614624,
     -0.019057443365454674, -0.011316255666315556, -0.28404971957206726, 0.021947722882032394, 0.14809450507164001,
     -0.03399353101849556, 0.14486601948738098, 0.029372306540608406],
    [-0.08688444644212723, 0.059021610766649246, -0.04356633126735687, -0.05635666474699974, -0.06618256121873856,
     0.03784306347370148, -0.028390873223543167, -0.11959916353225708, 0.15131330490112305, -0.10986153781414032,
     0.26504063606262207, -0.014996923506259918, -0.18311023712158203, -0.1465270072221756, -0.02054685726761818,
     0.132787823677063, -0.15844331681728363, -0.14072425663471222, -0.03436308726668358, 0.03167951479554176,
     0.09263727813959122, 0.009275928139686584, 0.06079806014895439, 0.05398169159889221, -0.14975234866142273,
     -0.33046334981918335, -0.05395473539829254, -0.1305539608001709, 0.03833119198679924, -0.03835916519165039,
     -0.0769687294960022, -0.03813271224498749, -0.21774184703826904, -0.038739778101444244, 0.029926951974630356,
     0.10597848892211914, -0.041068919003009796, -0.022675804793834686, 0.19812126457691193, -0.0060918694362044334,
     -0.27234911918640137, 0.01788349077105522, 0.02077840454876423, 0.2135891169309616, 0.1668279618024826,
     0.07211725413799286, 0.01285801362246275, -0.18244002759456635, 0.13323740661144257, -0.176538348197937,
     0.09709832817316055, 0.13340994715690613, 0.0786343663930893, 0.01818877086043358, -0.026796936988830566,
     -0.1362711787223816, 0.024508332833647728, 0.13798150420188904, -0.15548089146614075, -0.010911183431744576,
     0.09426340460777283, -0.010865474119782448, -0.003531615249812603, -0.0675625205039978, 0.2397293746471405,
     0.06751280277967453, -0.13158173859119415, -0.16140888631343842, 0.13102412223815918, -0.15210342407226562,
     -0.06826408207416534, 0.11218315362930298, -0.1492760181427002, -0.23376931250095367, -0.31960511207580566,
     0.04268324375152588, 0.4271407127380371, 0.15923142433166504, -0.13017480075359344, 0.01942850463092327,
     -0.06040424108505249, 0.03716190159320831, 0.16289010643959045, 0.15505844354629517, -0.01746194250881672,
     0.02850121445953846, -0.09159813076257706, 0.022882074117660522, 0.21642309427261353, -0.052486684173345566,
     -0.040950957685709, 0.18545661866664886, 0.0002133827656507492, 0.12406961619853973, 0.0008065137080848217,
     0.03970779851078987, -0.06053236126899719, 0.07094717025756836, -0.12407634407281876, 0.02260889858007431,
     -0.003920495510101318, 0.039994750171899796, 0.05232488363981247, 0.15887336432933807, -0.13679519295692444,
     0.12047833204269409, -0.016675764694809914, 6.183981895446777e-07, 0.048867639154195786, -0.007892514578998089,
     -0.04206910729408264, -0.09388108551502228, 0.06345386803150177, -0.2355291098356247, 0.1972378045320511,
     0.15815968811511993, 0.12634721398353577, 0.12515521049499512, 0.13440389931201935, 0.06255832314491272,
     -0.0004237992689013481, -0.013579899445176125, -0.321254163980484, 0.0221953634172678, 0.0991983711719513,
     -0.054686445742845535, 0.1295880526304245, -0.013774651102721691]]
list_numpy = [np.array(list_embeddings_known[0]),
              np.array(list_embeddings_known[1]),
              np.array(list_embeddings_known[2])]

image_path = "photo_test/nnq_test.png"
image = cv2.imread(image_path)

faces = ssd.detect_faces(image)
print("So luong khuon mat: ", len(faces))
embs = get_emb.extract_embeddings(image, faces)

start_time = time.time()
for emb in embs:
    result = face_recognition.compare_faces(list_numpy, emb)
    print(result)
end_time = time.time()

print("total time: ", end_time - start_time)

